<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>實作Python畫圖與資料處理-分析價格並解決數學建模問題 | UnZan&#39;s page</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="實際學習Python已經是七八年前了，近來為了研究程式交易策略，回頭再來摸索一下常用的Python套件，直接畫圖顯得有點無聊，所以結合一個小到不行的問題來處理。以下會用到pandas, numpy和matplotlib。">
    
    <link rel="preload" href="/blog/assets/css/0.styles.80dec5ea.css" as="style"><link rel="preload" href="/blog/assets/js/app.bfa19a8e.js" as="script"><link rel="preload" href="/blog/assets/js/2.cad96c93.js" as="script"><link rel="preload" href="/blog/assets/js/25.1876ced0.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.4733ae1b.js"><link rel="prefetch" href="/blog/assets/js/11.71a69a6b.js"><link rel="prefetch" href="/blog/assets/js/12.4e02fcbf.js"><link rel="prefetch" href="/blog/assets/js/13.c4ec9881.js"><link rel="prefetch" href="/blog/assets/js/14.e9ad209b.js"><link rel="prefetch" href="/blog/assets/js/15.8aa6ba03.js"><link rel="prefetch" href="/blog/assets/js/16.f143843c.js"><link rel="prefetch" href="/blog/assets/js/17.3f9eb94b.js"><link rel="prefetch" href="/blog/assets/js/18.bc721c6c.js"><link rel="prefetch" href="/blog/assets/js/19.de51d452.js"><link rel="prefetch" href="/blog/assets/js/20.17c9ac35.js"><link rel="prefetch" href="/blog/assets/js/21.e3236b5f.js"><link rel="prefetch" href="/blog/assets/js/22.3a1150b2.js"><link rel="prefetch" href="/blog/assets/js/23.caabbc19.js"><link rel="prefetch" href="/blog/assets/js/24.e0c358dc.js"><link rel="prefetch" href="/blog/assets/js/26.ffb56cd1.js"><link rel="prefetch" href="/blog/assets/js/27.09c2a19c.js"><link rel="prefetch" href="/blog/assets/js/28.2a4e842b.js"><link rel="prefetch" href="/blog/assets/js/29.68995748.js"><link rel="prefetch" href="/blog/assets/js/3.e8b6a6cb.js"><link rel="prefetch" href="/blog/assets/js/30.ce1f8621.js"><link rel="prefetch" href="/blog/assets/js/31.138e4476.js"><link rel="prefetch" href="/blog/assets/js/32.4b363b98.js"><link rel="prefetch" href="/blog/assets/js/33.8424877c.js"><link rel="prefetch" href="/blog/assets/js/4.f6eb1783.js"><link rel="prefetch" href="/blog/assets/js/5.355f0b7d.js"><link rel="prefetch" href="/blog/assets/js/6.3b852e3a.js"><link rel="prefetch" href="/blog/assets/js/7.92ff7e55.js"><link rel="prefetch" href="/blog/assets/js/8.1019bae4.js"><link rel="prefetch" href="/blog/assets/js/9.5094ca7b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.80dec5ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">UnZan's page</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/about/" class="nav-link">
  關於
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文章" class="dropdown-title"><span class="title">文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="文章" class="mobile-dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/discussion/" class="nav-link router-link-active">
  雜談
</a></li></ul></div></div> <a href="https://github.com/unzan401/blog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/about/" class="nav-link">
  關於
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文章" class="dropdown-title"><span class="title">文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="文章" class="mobile-dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/discussion/" class="nav-link router-link-active">
  雜談
</a></li></ul></div></div> <a href="https://github.com/unzan401/blog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="實作python畫圖與資料處理-分析價格並解決數學建模問題"><a href="#實作python畫圖與資料處理-分析價格並解決數學建模問題" class="header-anchor">#</a> 實作Python畫圖與資料處理-分析價格並解決數學建模問題</h1> <p>實際學習Python已經是七八年前了，近來為了研究程式交易策略，回頭再來摸索一下常用的Python套件，直接畫圖顯得有點無聊，所以結合一個小到不行的問題來處理。以下會用到pandas, numpy和matplotlib。</p> <p>數學建模是一種「利用數學來表示、分析、做出預測或以其他方式提供真實世界現象的視野」的過程（GAIMME 2019）。事實上每個人無時無刻都會有經歷數學建模的時機，包含定義單位、描述關係及解決問題等不同面向。</p> <p>介紹完建模就有點太遠了，我們還是快速進入我們的問題吧！</p> <p><img src="https://cdn-images-1.medium.com/max/800/0*OycJV0nD3Ih4skeY.jpg" alt=""></p> <p>大家都應該有留意到，便當中的菜色總會隨著時間變化，但實際上它的變化方式是怎麼樣呢？由於我個人很喜歡吃高麗菜，所以選擇以高麗菜做為研究的目標。</p> <p>體感上，在夏季的時候比較難在便當中看到高麗菜，過了秋季之後就慢慢出現。大概可以想像是夏季價格比較高，導致便當業者不願意購買，改用其他替代的葉菜。至於價格比較高的緣由，從過去所學的常識告訴我應該是產量較少，簡單的搜尋了一下，也確實得到高麗菜產季約為秋冬季。</p> <p>我們可以觀察當季好蔬果網站中關於甘藍-初秋的批發市場行情趨勢圖：<a href="https://www.twfood.cc/vege/LA1/%E7%94%98%E8%97%8D-%E5%88%9D%E7%A7%8B%28%E9%AB%98%E9%BA%97%E8%8F%9C,%E6%8D%B2%E5%BF%83%E8%8F%9C%29" target="_blank" rel="noopener noreferrer">https://www.twfood.cc/vege/LA1/甘藍-初秋(高麗菜,捲心菜)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://cdn-images-1.medium.com/max/800/1*2289oaM8Rqy81HyN0a_efQ.png" alt=""></p> <blockquote><p>初步觀察，可以認定說成交量和成交價間成反向關係：<br>
當成交量上升時，成交價下降；<br>
當成交量下降時，成交價上升。</p></blockquote> <blockquote><p>也確實在大概夏季的時候成交量就會大幅下滑。</p></blockquote> <p>至於如何具體描述他們的關係呢？</p> <p>我們可以利用pandas整理資料：</p> <p>#先將時間、成交量、成交價從網站上爬下來。再整理成一個dataframe</p> <p>import pandas as pd<br>
import numpy as np</p> <p>#爬下來的檔案被分成三個np.array，利用merge整理在一起</p> <p>data = pd.Dataframe()<br>
data = pd.merge(time,volume,left_index=True,right_index=True)<br>
data = pd.merge(data,value,left_index=True,right_index=True)</p> <p>#原始格式是timestamp，利用astype改成datatime<br>
time = time.astype(&quot;datetime64[ns]&quot;)</p> <p>#將index修正為時間，方便作圖。<br>
data.index = time[&quot;DATE&quot;]</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*kSX_v2mfQR3u_k5e9aGN1w.png" alt=""></p> <p>整理完後就是利用matplotlib進行視覺化，但事實上pandas的dataframe已經將plot方法給寫進去了，所以作圖比想像中的容易許多。</p> <p>#因為成交量和成交價量級差太多，所以利用secondary_y=True多畫出成交量的y軸。<br>
data[&quot;VALUE&quot;].plot()<br>
data[&quot;VOLUME&quot;].plot(secondary_y=True)</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*aamyjnoEqmVn-WoLFZ2Cyw.png" alt=""></p> <p>作出和網站上差不多的圖，接下來我們取x軸為成交量、y軸為成交價，直接畫出散布圖，看兩者間的關係是否和我們想像的一樣。</p> <p>data.plot(kind=&quot;scatter&quot;,x=&quot;VOLUME&quot;,y=&quot;VALUE&quot;)</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*q6sgVcmB3Jqcj4XoTXOYsg.png" alt=""></p> <p>看起來是蠻漂亮的直線關係，利用numpy的polyfit畫出小時候學過的迴歸直線。順便用另外一種方式畫圖將直線拼上散布圖。</p> <p>import matplotlib.pyplot as plt</p> <p>fig, ax = plt.subplots() #作出plt畫布<br>
ax.scatter(data[&quot;VOLUME&quot;],data[&quot;VALUE&quot;],color=&quot;red&quot;,) #畫散布圖</p> <p>#polyfit可以找出最接近數據點的迴歸n次多項式，這裡取直線為1次<br>
a , b = np.polyfit(data[&quot;VOLUME&quot;],data[&quot;VALUE&quot;],deg=1)<br>
f = lambda x: a*x + b<br>
x = np.array([min(data[&quot;VOLUME&quot;]),max(data[&quot;VOLUME&quot;])])<br>
ax.plot(x,f(x)) #製作迴歸線<br>
print(a,b)</p> <p>&gt;&gt;&gt; a = -0.001723, b = 41.779762</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*6oAac05HhTbyLhziE5bl-g.png" alt=""></p> <p>看起來相當漂亮，利用dataframe的corr方法可以簡單的作出兩者的相關係數r=-0.88777，呈現高度負相關。基本上可以用線性方程式來呈現成交量及成交價的關係。</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*1tHo_S1xMDtxUvsjzvq4Sw.png" alt=""></p> <blockquote><p>成交價 = -0.001723*成交量 + 41.779762</p></blockquote> <p>踉踉蹌蹌的得到小時候的供需法則後，接下來我們可以來看季節與成交量的關係。</p> <p>data[&quot;MONTH&quot;] = data.index.month #作出月份，當作季節的參考。</p> <p>fig, ax = plt.subplots()<br>
ax.scatter(data[&quot;MONTH&quot;],data[&quot;VOLUME&quot;],color=&quot;red&quot;)</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*8x18zrjkRyCZ1TGG0A-PVA.png" alt=""></p> <p>肯定不是一次函數了，乍看之下有點向開口向上的二次函數，或是遞增的三次函數。於是我們直接做做看三次函數的迴歸線。</p> <p>a,b,c,d = np.polyfit(data[&quot;MONTH&quot;],data[&quot;VOLUME&quot;],deg=3)<br>
f = lambda x: a*(x**3) + b*x**2 + c *x+d<br>
x = np.array(range(1,13))<br>
ax.plot(x,f(x)) #製作迴歸線<br>
fig</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*o4-VasuhhoJoI4mTyqMy7g.png" alt=""></p> <p>看起來還可以，但季節是個延續不斷的週期系函數，用多項式函數來趨近不太自然。想想過去學過的週期性函數有哪些？啊哈！三角函數。利用scipy的optimize.curve_fit函數，去符合原始資料。</p> <p>import scipy.optimize as optimize</p> <p>pi = np.pi<br>
x = np.array(range(len(data)))<br>
y = np.array(data[&quot;VOLUME&quot;])<br>
#定義目標函數<br>
def target_func(x, a0, a1, a2, a3):<br>
return a0 * np.sin(a1 * x + a2) + a3</p> <p>a0 = max(y) - min(y) #振福<br>
a1 = 12 #波長<br>
a2 = 0 #左右平移<br>
a3 = np.mean(y) #上下平移<br>
p0 = [a0, a1, a2, a3]<br>
para, _ = optimize.curve_fit(target_func, x, y, p0=p0) #最佳化出函數</p> <p>y_fit = [target_func(a, *para) for a in x]</p> <p>fig, ax = plt.subplots()<br>
ax.plot(x, y_fit, 'g')<br>
ax.plot(x, y, 'r')<br>
plt.xticks(x,np.array(time[&quot;DATE&quot;].dt.date))<br>
plt.locator_params(axis='x', nbins=5)</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*tHwVkhg8AicxI56HYthPvw.png" alt=""></p> <p>利用正弦函數逼近的相當漂亮呢！於是我們也找出時間與成交量的關係函數。</p> <blockquote><p>成交量=-5375.48*sin(12.03*時間-0.89)+13087.29<br>
其中時間的初始值為2016年2月，單位為月。<br>
最大最小值分別出現在3月和9月。</p></blockquote> <p>和之前的三次函數做個比較，也不算相差太遠。</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*O6c31M6JXl3c4tS90shu-g.png" alt=""></p> <p>找到函數後，最有價值的地方在於預測未來發展，透過這樣的建模活動，我就能更踏實的知道菜價與時間的關係，甚至是明確標出菜價高昂或便宜的時機。藉此可以在菜價高昂時找替代性商品，減少食物花費，或是開發在夏季大收的高麗菜品種，藉此賺得缽滿碗滿。</p> <h3 id="reference"><a href="#reference" class="header-anchor">#</a> Reference:</h3> <p>Pandas Document DataFrame<a href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html" target="_blank" rel="noopener noreferrer"><br>
https://pandas.pydata.org/pandas-docs/stable/reference/frame.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>當季好蔬果網站 甘藍-初秋的批發市場行情趨勢圖<a href="https://www.twfood.cc/vege/LA1/%E7%94%98%E8%97%8D-%E5%88%9D%E7%A7%8B%28%E9%AB%98%E9%BA%97%E8%8F%9C,%E6%8D%B2%E5%BF%83%E8%8F%9C%29" target="_blank" rel="noopener noreferrer"><br>
https://www.twfood.cc/vege/LA1/甘藍-初秋(高麗菜,捲心菜)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>python数据分析之曲线拟合（2）：三角函数sin/cos拟合<a href="https://blog.csdn.net/kaever/article/details/109659367" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/kaever/article/details/109659367<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.bfa19a8e.js" defer></script><script src="/blog/assets/js/2.cad96c93.js" defer></script><script src="/blog/assets/js/25.1876ced0.js" defer></script>
  </body>
</html>
